# ğŸ° æ³¨å†ŒåŠŸèƒ½å¼€å‘

---

## 1. åç«¯

### â‘  UserInfoDao

å¯¹åº”æ³¨å†ŒåŠŸèƒ½ï¼Œå³ç”¨æˆ·æ·»åŠ ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨ DAO å±‚è‡ªå®šä¹‰æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨ `CrudRepository`  ç±»ä¸­çš„ `save` æ–¹æ³•å³å¯ã€‚

ğŸš¨ æ³¨æ„ï¼š`save` æ–¹æ³•æ˜¯  `CrudRepository` ç±»ä¸­çš„ï¼Œç”±äº `JpaRepository` ç»§æ‰¿äº† `CrudRepository`ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å¯¹æ¥å£ç»§æ‰¿ `JpaRepository`  ä¹Ÿå¯ä»¥ç›´æ¥æ–¹ä¾¿çš„ä½¿ç”¨ `save` æ–¹æ³•è¿›è¡Œæ’å…¥ï¼Œ`saveAll` è¿›è¡Œæ‰¹é‡æ’å…¥

<img src="https://gitee.com/veal98/images/raw/master/img/20200925121457.png" style="zoom:50%;" />

### â‘¡ UserInfoService

å°è£…æ·»åŠ ç”¨æˆ·çš„æ–¹æ³•å’Œåˆ¤æ–­ç”¨æˆ·åæ˜¯å¦å·²ç»å­˜åœ¨äºæ•°æ®åº“ä¸­çš„æ–¹æ³•ï¼š

```java
@Service
public class UserInfoService {

    @Autowired
    UserInfoDao userInfoDao;
	
    ......
        
    // æ ¹æ® username æŸ¥è¯¢
    public UserInfo getByUsername(String username){
        return userInfoDao.findByUsername(username);
    }

    
    // æ·»åŠ ç”¨æˆ·
    public void addUser(UserInfo userInfo){
        userInfoDao.save(userInfo);
    }

    // åˆ¤æ–­ç”¨æˆ·åæ˜¯å¦å­˜åœ¨
    public boolean isExistUsername(String username){
        UserInfo userInfo = getByUsername(username);
        if(userInfo == null)
            return false; // ç”¨æˆ·åä¸å­˜åœ¨
        else
            return true; // ç”¨æˆ·å·²ç»å­˜åœ¨
    }

}
```

### â‘¢ RegistController

```java
@RestController
public class RegistController {

    @Autowired
    UserInfoService userInfoService;

    /**
     * ç”¨æˆ·æ³¨å†Œ
     * @param requestUserInfo
     * @return
     */
    @CrossOrigin
    @PostMapping("api/regist")
    public Result regist(@RequestBody UserInfo requestUserInfo){
        String username = requestUserInfo.getUsername();

        // åˆ¤æ–­è¯¥ç”¨æˆ·åæ˜¯å¦å·²ç»å­˜åœ¨
        if(userInfoService.isExistUsername(username)){
            return ResultFactory.buildFailResult("è¯¥ç”¨æˆ·åå·²å­˜åœ¨");
        }
        else{
            userInfoService.addUser(requestUserInfo);
            return ResultFactory.buildSuccessResult("æ³¨å†ŒæˆåŠŸ", requestUserInfo);
        }
    }

}

```

## 2. å‰ç«¯

### â‘  Regist.vue

å’Œ `Login.vue` å·®ä¸å¤šï¼š

```vue
<template>
    <body class = "regist_bg">
        <div class = "regist_container">
            <el-form ref="RegistForm" :model="RegistForm" label-width="80px">
                 <h2 class = "regist_title">æ³¨å†Œ</h2>
                 <el-form-item label="ç”¨æˆ·å">
                    <el-input v-model="RegistForm.username"></el-input>
                 </el-form-item>
                 <el-form-item label="å¯†ç ">
                    <el-input v-model="RegistForm.password"></el-input>
                 </el-form-item>
                 <el-form-item label="é‚®ç®±">
                    <el-input v-model="RegistForm.email"></el-input>
                 </el-form-item>
                 <el-form-item>
                    <el-button type="primary" @click = "regist">æ³¨å†Œ</el-button>
                    <el-button @click = "goToLogin">ç™»å½•</el-button>
                 </el-form-item>
            </el-form>
        </div>
    </body>    
</template>

<script>
    export default {
        name: 'Regist',
        data() { 
            return {
                RegistForm: {
                    username: '',
                    password: '',
                    email: ''
                }
            }
        },
        methods: {
            // æ³¨å†Œ
            regist(){
                this.$axios.post('/regist', {
                    username: this.RegistForm.username,
                    password: this.RegistForm.password,
                    email: this.RegistForm.email
                }).then(successResponse => {
                    // åç«¯å‘é€è¿‡æ¥çš„æ˜¯ Result ç±»å‹æ•°æ®ï¼Œåˆ¤æ–­ Result.code å³å¯
                    if(successResponse.data.code === 200){
                        // æ³¨å†ŒæˆåŠŸè¿›å…¥ç™»å½•ç•Œé¢
                        this.$alert(successResponse.data.message, 'ğŸ‰ Successful', {
                            confirmButtonText: 'ç¡®å®š'
                        })
                        this.$router.replace({path: '/login'}) 
                    } else {
                        this.$alert(successResponse.data.message, 'ğŸ˜” Failed', {
                            confirmButtonText: 'ç¡®å®š'
                        })

                    }
                }).catch(failResponse => {

                })
            },
            // è¿›å…¥ Login ç•Œé¢
            goToLogin(){
                this.$router.replace({path: '/login'})
            }
        }
    }
</script>

<style scoped>
    .......
</style>
```

### â‘¡ è·¯ç”±é…ç½®

```js
import Regist from '../components/Regist'

......

    {
        path: '/regist',
        name: 'Regist',
        component: Regist
    },
```

## 3. æ•ˆæœ

æ³¨å†Œå¹¶ç™»å½•æµ‹è¯•ï¼Œçœ‹èƒ½å¦æ­£å¸¸è·³è½¬ã€‚

æ³¨å†ŒæˆåŠŸ/å¤±è´¥åéƒ½å¯ä»¥çœ‹åˆ°å‰ç«¯èƒ½å¤Ÿæ­£ç¡®è·å–åç«¯ä¼ è¿‡æ¥çš„ messageï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20200927101129.png" style="zoom:67%;" />

<img src="https://gitee.com/veal98/images/raw/master/img/20200927101200.png" style="zoom:67%;" />